## 상태 코드

- 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능

| HTTP Status Code | Description |
| --- | --- |
| 1xx (Informational) | 요청이 수신되어 처리중 |
| 2xx (Successful) | 요청 정상 처리 |
| 3xx (Redirection) | 요청을 완료하려면 추가 행동이 필요 |
| 4xx (Client Error) | 클라이언트 오류, 잘못된 문법 등으로 서버가 요청을 수행할 수 없음 |
| 5xx (Server Error) | 서버 오류, 서버가 정상 요청을 처리하지 못함 |

```markdown
299, 451 같이 클라이언트가 인식하지 못하는 상태코드를 서버에서 반환하면?

-> 클라이언트는 상위 상태코드로 해석해서 처리하면 된다
```

<br>

`📢 아래에서는 주로 사용되는 상태 코드에 대해서만 살펴볼 예정입니다`
## 1xx (Informational)

- 거의 사용하지 않으므로 생략

<br>

## 2xx (Succesful)

### 200 OK

- 요청 성공

### 201 Created

- 요청 성공해서 새로운 리소스가 생성
- Location 헤더 필드로 생성된 리소스 반환

```markdown
💡 예시를 들어보자

HTTP/1.1 201 Created
Content-Type: application/json
**Location: /members/100**

{
	"name" : "gibeom"
	"age" : "26"
}
```

### 202 Accepted

- 요청이 접수되었으나 처리가 완료되지 않은 상태

```markdown
💡 예시를 들어보자

요청 접수일 기준 다음날 09시에 배치 프로세스가 요청을 처리하는 구조
(바나프레소 스탬프 10개시 무료커피쿠폰)
```

### 204 No Content

- 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없을 경우

```markdown
💡 예시를 들어보자

노션에 메모를 기입하고 있는데 도중 도중 저장 버튼을 누른다
이때 저장을 성공했어도 응답결과 본문에는 아무 데이터가 필요하지 않는다
또한 저장을 성공했어도 같은 화면을 유지해야 한다 (계속 편집해야 하기 때문에)

따라서 결과 내용이 없어도 204 메시지만으로 성공을 인식할 수 있다!
```

<br>

## 3xx (Redirection)

### Redirect

- 웹 브라우저는 3xx 응답의 결과에 Location 헤더가 있으면, 해당 위치로 자동 이동

### Redirection 종류

| 종류 | 설명 | 예시 |
| --- | --- | --- |
| 영구 리다이렉션 | 특정 리소스의 URI가 영구적으로 이동 | /members → /users <br> /event → /new-event |
| 일시 리다이렉션 | 일시적인 변경 | PRG: Post/Redirect/Get |
| 특수 리다이렉션 | 결과 대신 캐시를 사용 |  |

### 영구 리다이렉션

- 리소스의 URI가 영구적으로 이동
- 원래의 URL을 더이상 사용하면 안된다는 의미, 검색 엔진등에서도 변경 인지
- 해당되는 코드


    | 코드 | 설명 |
    | --- | --- |
    | 301 Moved Permanently | Redirect 시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음 |
    | 308 Permanent Redirect | Redirect 시 요청 메서드와 본문 유지 (처음 POST면 Redirect도 POST) |
    
    `보통 패스가 변경되면 (event → new-event) 요청받는 데이터들이 변경될것이기 때문에 웬만하면 GET으로 돌리는 301을 사용하는 것이 좋다`


### 일시적인 리다이렉션

- 리소스의 URI가 일시적으로 변경
- 따라서 검색 엔진 등에서 URL을 변경하면 안됨
- 해당되는 코드

  `모두 기능은 동일하지만 요청메서드를 변경할지 안할지에 따라 나눠짐!`

	| 코드 | 설명 |
	| --- | --- |
	| 302 Found | Redirect 시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음 |
	| 303 See Other | Redirect 시 요청 메서드가 GET으로 변경 |
	| 307 Temporary Redirect | Redirect 시 요청 메서드와 본문 유지 (요청 메서드를 변경하면 안됨!) |

#### PRG란?

- POST / Redirect / GET

```markdown
💡 예시를 들어보자

노트북을 사려고 장바구니에 노트북을 담고 수량 1개를 하여 결제를 눌렀다
이때 흐름은 이렇게 될 것이다

1. POST /order {...}
2. DB insert
3. 주문 성공 결과 반환

이때 사용자가 주문 성공 결과창이 나오고 '새로고침'을 눌렀을 경우
브라우저는 이전 요청을 그대로 보내므로 다시 1번부터 실행된다
즉, POST가 다시 발생하여 중복 주문이 발생된다..!

이런 상황을 PRG 패턴을 사용하면 해결할 수 있다

1. POST /order {...}
2. DB insert
3. 주문 성공 결과 반환을 302 or 303으로 반환 (GET으로 변경)
		302 Found
		Location: /order-result/77

이런 경우 새로고침을 동일하게 눌렀을 경우
1. GET /order-result/77
2. 결과화면만 계속 반환

이런식으로 변경 되기에 중복 주문을 방지할 수 있다!
```

```markdown
📢 여담!

초기 스펙에서 302코드의 의도는 메서드를 유지하는 것이였다
하지만 웹 브라우저들이 대부분 GET으로 바꾸도록 개발이 되었다
하지만 일부 브라우저는 302를 해도 메서드를 유지하는 것도 있따

따라서 애매모호한 302 보다는 303, 307을 사용하는 것을 권장하지만,
이미 많은 애플리케이션들이 302를 Default로 사용한다...

-> 자동 리다이렉션에 GET으로 변환되도 무관한거면 302를 사용해도 문제 없음
```

### 기타 리다이렉션

- 300 Multiple Choices : 사용 안함
- 304 Not Modified
    - 캐시를 목적으로 사용
    - 클라이언트에게 리소스가 수정되지 않았음을 알려줌
    - 따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. (캐시로 Redirect)
    - 304 응답은 응답에 메시지 바디를 포함하면 안된다. (로컬 캐시를 사용해야 하므로)
    - 따라서 조건부 GET이나 HEAD 요청시 304를 사용한다

<br>

## 4xx (Client Error)

- 클라이언트의 요청에 잘못된 문법등으로 서버가 요청을 수행할 수가 없음 (오류원인 : 클라이언트)
- 4xx은 요청 자체가 잘못됐기 때문에 똑같은 재시도를 아무리 해도 계속 실패함

### 400 Bad Request

- 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음 (요청 해석 불가)
- 주로 요청 구문이나 메시지 스팩등이 맞지 않을 때 발생
    - ex) 요청 파라미터가 잘못됨, API 스펙이 맞지 않을 때 등


### 401 Unauthorized

- 인증(Authentication) 되지 않음 (로그인이 안된 상태 → 본인이 누구인지 모름)
- WWW-Authenticate 헤더와 함께 인증 방법을 설명

### 403 Forbidden

- 인증자격은 있지만, 인가되지 않아서 접근 권한이 불충분한 경우
- 인가(Authorization): 권한부여 (Admin 권한처럼 특정 리소스에 접근할 수 있는 권한, 인증이 있어야 인가가 있음)

### 404 Not Found

- 요청 리소스가 서버에 없기 때문에 요청 리소스를 찾을 수 없음
- 또는 클라이언트가 권한(인가)이 부족한 리소스에 접근할 때 해당 리소스를 숨기려고도 사용

### 409 Conflict

- 클라이언트의 요청이 서버의 상태(타깃 리소스)와 충돌이 발생한 경우
- 해당 요청의 처리 중 비지니스 로직상 불가능하거나 모순이 생긴 경우
    - ex) 이메일 중복처럼 리소스가 충돌되는 경우 사용에 적합

<br>

## 5xx (Server Error)

- 서버의 문제로 오류 발생
- 서버에 문제가 있기 때문에 계속해서 재시도 할 시 성공할 수도 있음 (서버 복구가 되는 등)

### 500 Internal Server Error

- 서버 내부 문제로 오류 발생 (특정하지 않고 모든 종류의 오류)
- 따라서 애매한 경우는 다 500에러

### 503 Service Unavailable

- 과도한 트래픽으로 인한 과부하로 서버가 일시적으로 요청을 처리할 수 없을 경우
- 예정된 작업등으로 잠시 서버를 다운시킨 경우 (서버 유지보수, 게임패치 등)
- Retry-After 헤더필드로 복구완료 예상시간을 반환할 수 있음

```markdown
💡 참고하자

500에러는 정말 서버의 문제가 생길때만 발생시켜야 한다
따라서 비지니스 적인 예외케이스 같은 경우는 500에러가 아닌 4xx나 2xx 코드로 해결해야 한다,

ex 1) 20살 이상 주문할 수 있는 제품을 18살이 주문할 경우 -> 400 or 403
ex 2) 회원가입 시 이메일/아이디가 중복될 경우 -> 409
```

<br>

### Reference

- ****[회원가입 시 이메일/아이디가 중복될 때의 응답 HTTP status code](https://blog.outsider.ne.kr/1121)****
- [REST API 관점에서 바라보는 HTTP 상태 코드(HTTP status code)](https://sanghaklee.tistory.com/61)
