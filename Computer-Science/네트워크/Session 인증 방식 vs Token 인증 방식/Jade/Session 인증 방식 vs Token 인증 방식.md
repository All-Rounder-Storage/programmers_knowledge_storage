# Session 인증 방식 vs Token 인증 방식

`Session 인증 방식과 Token 인증 방식의 가장 큰 차이점은 인증 확인 증거를 저장하는 위치에 있다. Session 인증 방식은 DB 서버에, Token 인증 방식은 클라이언트 측에 저장한다.`

💡 세션과 토큰에 대해 알아보기 전에 인증 & 인가에 대해 먼저 알아보자
- 인증 (Authentication): 특정 서비스에 일정 권한이 주어진 사용자임을 아이디랑 패스워드 등을 통해서 인증을 받는 것을 말한다. (로그인)
- 인가 (Authorization): 한번 인증을 받은 사용자가 이후 서비스의 여러 기능을 사용할 때 해당 기능을 사용할 수 있는 권한이 있는지를 확인한다.
    - Example) 인스타그램에 내 계정으로 로그인 하여 친구들 게시물에 댓글을 달 때 권한이 있는지를 확인한다.

## Session 인증 방식

`세션 Id를 사용해서 어떤 사용자가 서버에 로그인 되어있음이 지속되는 이 상태를 "세션"이라고 한다.`

1. 사용자가 로그인에 성공하면, 서버는 '세션 Id' 를 사용자의 브라우저에 보낸다.
2. 브라우저가 이 '세션 Id' 란 이름의 쿠키로 저장한다.
3. 이 브라우저는 다음 사이트에 요청을 보낼때마다 해당 '세션 Id' 란 이름의 쿠키를 같이 실어보낸다.
4. 서버에서는 이 '세션 Id' 가 넘어오게 되면, 서버는 메모리 혹은 DB에서 해당되는 유저가 있다면 Authorization 을 해준다.

### 장점과 단점
```markdown
- 장점: 
    1. 정보가 서버에 저장되기 때문에 토큰 기반 인증에 비해 위변조 혹은 손상 우려가 적다.
    2. 세션은 stateful 해서 모든 사용자들의 상태를 기억하고 있다. 구현하기 부담되고 고려사항은 많으나, 구현이 됐을시 기억하는 대상의 상태들을 언제든 제어할 수 있다는 장점이 있다.

- 단점:
    1. 사용자가 동시에 많이 접속을 하는 경우에 서버에 메모리 혹은 DB가 부족해지는 현상이 일어난다.
    2. 세션을 관리 할 때 자주 사용되는 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록 설계되어 있다. 따라서 쿠키를 여러 도메인에서 관리하는것은 번거로우며 CORS 문제가 생겨날 수 있다.
```

![session-based-authentication](https://user-images.githubusercontent.com/61952198/179385901-6f623492-3078-4cbe-97c9-710204f6f39c.png)

  
## Token 인증 방식 (JWT - JSON Web Token)

1. JWT 를 사용하는 서비스에서는, 사용자가 로그인을 하면 서버에서 토큰이라는 표를 출력해서 건네준다.
    - 세션과는 달리 서버는 어떠한 값도 기억하지 않고 모든 값을 준다.
2. 클라이언트는 토큰을 별도의 공간에 저장한 후 (example. localStorage, Cookie), 서버에 새로운 요청을 보낼 때 헤더에 토큰을 함께 보낸다.
3. 서버는 해당 JWT 의 유효성을 검사하고 인가한다.

- JWT 의 구성 요소
    1. Header (헤더) : 두가지 정보를 지니고 있다.
        - 토큰의 타입 (type): 언제나 JWT 가 들어간다. (type 이 JWT 이어야 JWT 이다 - 고정값)
        - alg (algorithm 의 약자): 3번 서명 값을 만드는데 사용될 해싱 알고리즘이 지정된다. (example. SHA 256, RSA, HMAC 등 여러 암호화 방식 중 하나를 지정할 수 있다.)
        ```json
        {
            "typ": "JWT",
            "alg": "HS256"
        }
        ```
       
    2. Payload (페이로드) : Base64로 디코딩 했을 때 JSON 형식으로 토큰에 담을 여러 정보들이 담겨있다. 정보의 한 조각을 '클레임 (claim)' 이라고 부르고, name / value 의 한 쌍으로 이루어져있다.
        - 클레임의 종류는 크게 세개로 분류된다.
            1. 등록된 (registered) 클레임 : 서비스에 필요한 정보가 아닌, 토큰에 대한 정보들을 담기위하여 이름이 이미 정해진 클레임들이다. 등록된 클레임의 사용은 모두 선택적 (optional)이다. 
            2. 공개 (public) 클레임 : 사용자가 정의할 수 있는 클레임으로 공개용 정보 전달을 위해 사용된다.
            3. 비공개 (private) 클레임 : 보통 클라이언트와 서버 사이에 정보를 공유하기 위해 만들어진 사용자 지정 클레임이다.
      
    3. Verify Signature (서명) : 1번 헤더와 2번 페이로드, 그리고  '서버에 감춰놓은 비밀 값' 세가지를 가지고 암호화 알고리즘에 넣고 만들면 서명 값을 만들어 낼 수 있다.
        - 3번 서명값과 계산값이 일치하고, 유효기간도 지나지 않았다면 그 사용자는 로그인 된 회원으로서 인가를 받는다.
    
![jwt](https://user-images.githubusercontent.com/61952198/179385827-b57b50c5-5159-4bbd-9111-fe266b9d39cb.png)


### 장점과 단점

```markdown
- 장점:
    1. JWT 별도의 서버 메모리나 DB가 필요하지 않고, 서버는 완전히 무상태성(Stateless)으로 남게된다.
    2. 서버는 stateless 상태로 남아있기 때문에 확장성(Scalability)을 확보할 수 있다.
    
- 단점:
    1. JWT 가 브라우저에 그대로 노출되어있으므로 위변조, 손상의 위험이 크다. (XSS 공격)
    2. 한번 발급된 토큰은 서버에서 제어가 불가능 하다. 만약 토큰이 공격자(해커)에게 탈취되었다면, 공격자는 토큰이 만료될 때까지 계속 공격 할 수 있다.
```

![token-based-authentication](https://user-images.githubusercontent.com/61952198/179385904-be25a48b-c044-4391-bcb0-fbc6b70d24c7.png)


<br>

Reference

---

- [세션 VS. 토큰! JWT가 뭔가요?](https://www.youtube.com/watch?v=1QiOXWEbqYQ)
- [Differences Between Cookies, Sessions and Tokens](https://www.youtube.com/watch?v=tosLBcAX1vk)
