# 쿠키 vs 세션

## 쿠키란 ?
- 클라이언트 단에 저장되어있는 데이터 파일
- KEY-VALUE 의 데이터 쌍으로 이루어져 있다.

## 쿠키의 특징
- 최대 300개 까지 저장, 하나의 도메인에 20개의 값만 가질 수 있음, 하나의 쿠키의 크기는 4KB 까지 지원
- 클라이언트의 상태 정보를 저장했다가(로컬) 필요할 때 해당 쿠키를 참조 한다.
- Request header 에 넣어서 자동으로 서버에 전송 가능
- Response header 에 set-cookie 속성으로 클라이언트에 쿠키 생성 가능

### 쿠키의 구성 요소
- 이름 : 각 쿠키를 구별 하는데 사용되는 이름 (key)
- 값 : 각 key 에 할당된 값(value)
- 유효시간 : 쿠키가 유효한 시간
- 도메인 : 쿠키를 보낼 도메인

### 쿠키의 동작 과정
1. 클라이언트에서 정보 요청
2. 서버에서 요청에 응답하며 필요시에 클라이언트에 저장할 cookie 를 세팅하여 보낸다.
3. 넘겨 받은 쿠키를 저장하고 보관하다가, 서버에 요청이 필요할 때 함께 넘겨 준다.
4. 브라우저의 종료 후에도 유효기간 까지 보관하고 있으며, 동일한 사이트 재접속 시에도 서버에 저장된 쿠키를 보낸다.

### 쿠키의 장단점
장점
- 클라이언트에서만 처리해도 되는 정보들은 서버에 데이터를 요청하지 않고도 처리 가능
  ex. 마케팅 수신 동의 일회성 팝업 노출 여부 등

- 서버의 저장공간을 절약할 수 있다.

단점
- 클라이언트 단에 저장하기 때문에 보안이 취약
  
- 웹 브라우저 마다 지원 형태가 다르다.
  
- 이용하는 브라우저 변경시 쿠키가 연동되지 않는다.
  
- 사용자가 거부할 경우 사용할 수 없다.

## 세션이란 ?
- 쿠키를 기반으로 하지만, 사용자 정보 파일을 **서버에서 관리**
- 클라이언트의 구분을 위해 세션 id를 각각 할당

### 세션의 특징
- 서버의 메모리에 저장되며, 클라이언트에서 쿠키로 세션 id 를 보내면, 이를 통해 저장된 정보를 활용할 수 있다.
- 서버에서 접근하고, 관리하기 때문에 보안성이 쿠키보다 높다.

### 세션의 동작 flow
1. 클라이언트의 정보 요청

2. request header 필드의 cookie 에 session-id 값 있는지 확인

3. id 값이 존재한다면 그에 맞는 세션을 찾아서 값을 이용,
   없다면 새로 생성하여 session-id 를 Response header, set-cookie 로 전달 하여 생성하게 만든다.

4. 클라이언트의 재접속 시 해당 id로 사용자 상태 정보를 참조해 요청한 필요 정보를 제공한다.

### 세션의 장단점
장점 
- 클라이언트에서 session-id 로 접근하기 때문에 세션의 양이 방대해도 네트워크 부하가 거의 없다.

- 세션에 정보를 저장해 불필요한 DB 접근을 막을 수 있다.
  
- 서버에 저장되어 웹브라우저에 의존할 필요가 없다.

- 저장을 허용하는 용량이 크다.
 
단점
- 트래픽이 높을수록 서버에 부하가 발생할 수 있다.(세션에 있는 정보를 이용하기 위해 조회 해야 하기 때문)

- 사용자가 많아질 수록 서버의 많은 메모리를 필요로 한다.(사용자 마다의 세션 정보를 저장해야하기 때문이다.)

## 쿠키와 세션의 차이점
- 서로 다른 저장 위치 : **쿠키는 클라이언트에서 저장 / 세션은 서버에서 저장**
- 서로 다른 저장 형식 : **쿠키는 text / 세션은 object**
- 서로 다른 응답 속도 : **쿠키 > 세션** (세션은 서버에서 처리되고 응답하는 과정이 존재하기 때문)
- 서로 다른 삭제 기간 : **쿠키는 유효기간 까지 저장 / 세션은 브라우저에서 나갔을 경우 삭제**
- 보안성 : **세션 > 쿠키** (세션은 서버에서 저장함으로 비교적 보안성이 높다)
- 저장 용량 : **세션 > 쿠키** (쿠키는 제한 되어있지만 세션은 서버가 허락하는 한 까지 무한으로 가능하다.)

## 쿠키와 세션을 사용하는 이유
- HTTP 프로토콜의 비연결성, 무상태성을 보완하기 위해 사용된다.
  클라이언트가 누구인지 서버는 한번의 통신 후 연결이 끊기면 모르기 때문에 이를 매번 사용자에게 로그인을 하게 하는 과정은 UX 가 좋지 않다.
  이러한 점을 쿠키와 세션으로 보완하여 서비스 할 수 있게 한다.
  
- 서비스 제공을 위한 필수 데이터의 유지에 사용한다.

## 앱에서의 쿠키 / 세션
- 앱은 따로 쿠키와 세션의 개념이 존재하지 않는다.
  - API 통신 시 set-cookie header 를 통해 세팅하는 것과, 서버로 쿠키를 보내는 것 모두 가능하나 주로 사용하지는 않는다.

- 쿠키와 비슷한 동작을 할 수 있는 기능으로는 **sharedPreference** 가 존재한다.
  - key-value 형식으로 값을 저장할 수 있다.
  - 앱의 내부 저장소에 저장되고, 해당하는 앱에서만 접근이 가능하며, 앱 삭제 시 삭제 된다.
  - 보안을 위해 암호화 프리퍼런스 기능도 지원한다.(값 저장 시 암호화 처리 되어서 저장)
  - ex. a/b 테스트 flag 저장, 자동 로그인 체크 여부, 마케팅 푸시 팝업 노출 여부, 일회성 팝업 노출 여부 등
  
Reference
- [cookie vs session](https://www.javatpoint.com/session-vs-cookies)