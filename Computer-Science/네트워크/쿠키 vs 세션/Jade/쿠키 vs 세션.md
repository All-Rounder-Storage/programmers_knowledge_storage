# 쿠키 vs 세션

💡 쿠키와 세션에 대해 배워보기 전에 HTTP 의 특징인 **비연결성(Connectionless)** 과 **비상태성(Stateless)** 을 생각해보면 좋다. 

- HTTP 는 서버에 연결 후 request 에 response 를 받으면 연결을 끊어버리고(Connectionless), 바로 끊어져버리는 연결 때문에 이전 상태를 알 수 없다 (Stateless).
- 이러한 특징 때문에 같은 사용자가 요청을 보낼때마다 매번 새로운 사용자로 인식해버리게 되는 특징이 있다.

> 하지만!    
> 
> 실제로 우리가 웹사이트를 사용할 때를 떠올려보면 로그인 후 다시 로그인할 필요 없이 다른 기능들을 이용할 수 있고, 브라우저를 종료했다가 다시 접속했을 때도 로그인이 돼있는 경험을 해봤을 것 이다.
> 
> 이러한 HTTP 의 비연결성(Connectionless)과 비상태성(Stateless)을 보완하게 해주는 것이 바로 **쿠키** 와 **세션** 이다.

## 1. 쿠키 

`서버는 쿠키를 이용하여 클라이언트 브라우저에 데이터를 넣을 수 있다.`

- 사용자가 사이트에 방문하면, 브라우저는 서버에 request 를 보낸다. (예를들어, 로그인 요청일 수 있다.)
- 서버는 이에 response 를 보내며, 이 response 에는 인증된 사용자의 정보 혹은 사용자가 찾던 데이터와 페이지에 대한 정보가 존재한다.
- 또한, 그 response 에 서버가 브라우저에 저장하고자 하는 쿠키가 있을 수 있다. (response 에 `set-cookie` 에 담겨 클라이언트로 넘어온다.)

> 클라이언트 브라우저에 쿠키가 저장된 후, 클라이언트는 새로운 request 를 보낼 때마다 저장해뒀던 쿠키를 HTTP 헤더에 같이 넣어서 서버로 보내게된다.
> 이를 통해, 서버는 해당 사용자가 누구인지 구별할 수 있게 된다.

#### 쿠키의 특징

1. 쿠키는 도메인에 따라 제한된다.
    - 하나의 도메인 당 20개의 쿠키를 가질 수 있다. 
    - example) 유튜브 서버에서 보내는 쿠키는, 유튜브 서버로 요청을 보낼때만 보내지게 된다.
    
2. 이름, 값, 유효기간, 경로 정보로 구성돼있다.
    - example) 어떤 쿠키는 하루, 혹은 한달, 서버가 정한 기간에 따라 유효기간이 다르다
    
3. 쿠키는 인증 정보 뿐만 아니라 여러가지 정보를 저장할 수 있다.
    - example) 팝업에서 “오늘 더 이상 이 창을 보지 않음” 체크가 이에 해당한다.

4. 쿠키는 클라이언트(브라우저) 로컬에 key-value 쌍으로 저장되는 작은 데이터 파일이다.    

## 2. 세션

- 세션은 기본적으로 쿠키를 이용하여 구현이 된다.

```markdown

사용자가 아이디와 비밀번호를 서버에 보낸다고 가정할때,

{
    name: 'Jade'
    password: 'thisismypasswordhehe'
}

서버는 클라이언트의 로그인 요청의 유효성을 확인하고(아이디와 비밀번호 검사), 세션 Database 에 'Jade' 라는 유저를 생성한다.
```

- 해당 세션에는 별도의 세션 id가 존재하고, 서버가 response 를 보낼 때 해당 id는 response 에 `set-cookie` 를 통해 브라우저로 돌아오고 저장된다.

> 따라서, 같은 웹사이트의 다른 페이지로 이동하면 브라우저는 세션 id를 갖고있는 쿠키를 서버에게 보내게된다. (쿠키는 자동으로 보내지기 때문이다.)
> 1. 서버는 request 로 들어오는 쿠키를 확인한다. (이 순간까지는 아직 서버가 클라이언트가 누구인지 모른다. 세션 id가 있는 쿠키를 지닌 요청이 있다는 것만 안다.)
> 2. 해당 세션 id를 가지고 세션 Database 를 확인하고, 이 해당 id는 Jade 라는 것을 알게 된다.
> 3. 현재 페이지에서 해당 요청이 끝나고, 다른 페이지로 이동하면 이 모든 프로세스는 다시 반복된다.

#### 세션의 특징

1. 비교적 보안성이 높다.
   - 세션은 쿠키를 이용해서 클라이언트에 session-id 만 저장하고, 중요한 유저 정보는 모두 서버에 있기 때문이다.

2. 서버에 부하가 발생할 수 있다.
   - 현재 로그인한 유저들의 모든 세션 id를 db에 저장하기 때문이다.
   
## 쿠키 vs 세션

|-|쿠키(Cookie)|세션(Session)|
|---|---|---|
|저장위치|클라이언트|클라이언트(세션 id) & 서버(중요 정보)|
|유효기간|쿠키 저장시 설정된 기간|브라우저 종료시(기간 설정도 가능)|
|속도|쿠키는 파일에서 읽기 때문에 상대적으로 속도가 빠름|세션은 request 마다 서버에서 처리를 해야하기 때문에 비교적 느림|
|보안|쿠키는 탈취와 변조가 가능|세션은 ID 값만 가지고 있기 때문에 상대적으로 보안성이 높음|
|용량|총 300개, 한 도메인당 20개, 한 쿠키당 4KB|서버가 허용하는 한 제한 없음|

<br>

Reference

---
- [Differences Between Cookies, Sessions and Tokens](https://www.youtube.com/watch?v=tosLBcAX1vk)